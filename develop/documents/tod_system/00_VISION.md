# 00_VISION - Dialogue System Design Pack

本ディレクトリは、LangGraphベースの対話システム（NLU → DM(DST/DAE/DP) → NLG）の設計・実装・評価・運用を一貫して扱うための「設計パッケージ」です。  
この 00 は **“ビジョン（目的・成功条件・品質目標）” をまとめた起点ページ**です。詳細な仕様は各章（01以降）に委譲します。

---

## Vision（何のために作るか）
### 目的（Why）
- ユーザーが自然文で問い合わせ・依頼しても、**目的を理解して必要な確認を行い**、最短で解決に導く対話システムを提供する
- 解決不能・リスク・権限外の場合は、**安全に縮退（fallback / handoff）**して、確実に次の手段へつなぐ

### 対象（Who / Where）
- 対象ユーザー：顧客 / 社員（想定）
- 利用チャネル：Web / Teams / LINE 等（チャネル差分は 09）
- 対応範囲：タスク志向（手続き案内、FAQ、情報収集、ツール実行）

---

## Success Criteria（成功条件）
> 数値は「暫定」。計測方法は 11 に定義し、スプリントで更新する。

- 解決率（Self-serve）：目標 ___%
- 平均ターン数：目標 ___ ターン以下
- 再質問率（clarify率）：目標 ___%（高すぎても低すぎても問題）
- エスカレーションの適切性：誤エスカレーション率 ___% 未満 / 漏れ ___% 未満
- PII/規約違反インシデント：0（必達）
- 運用指標：P95 レイテンシ ___ 秒以下、月次コスト上限 ___ 円

---

## Quality Goals（品質目標 / 優先順位）
> 設計・実装判断の“北極星”。迷ったらここに戻る。

### Q1. Safety（安全性・コンプライアンス）
- 禁止領域・危険行為・不適切コンテンツを生成しない
- PIIを必要以上に保持・出力しない（マスキング、最小化）
- ツール呼び出しは許可された範囲のみ（許可リスト、権限制御）

### Q2. Reliability（信頼性・縮退）
- 外部API失敗・タイムアウトでも致命停止せず、fallback/handoffできる
- 冪等性（チケット起票など）・リトライ上限・タイムアウトが明確

### Q3. Operability（運用性・観測可能性）
- ノード単位でトレースでき、原因追跡ができる（mode/action/latency）
- 監査ログの方針があり、問い合わせ単位で再現可能

### Q4. Maintainability（保守性・拡張性）
- 新ユースケース/新ツール追加が安全に行える（契約：State/Node Specs）
- 変更影響範囲をテストで抑えられる（回帰セット、golden）

### Q5. Cost/Performance（コスト・性能）
- トークン消費と外部API回数を観測し、上限超え時は縮退できる
- 応答の体感速度を一定に保つ（P95）

---

## Scope Snapshot（ざっくり範囲）
> 詳細は 01/02 が正。ここでは“認識合わせ”だけ。

### In Scope（例）
- NLU→DM→NLGの基本フロー
- STEP_BY_STEP と SLOT_FILLING の統合
- 外部ツール連携（必要なら）とエラー処理
- 監査ログ、観測、評価、リリース運用（最小セット）

### Out of Scope（例）
- 公式判断が必要な業務の自動承認（返金可否など）
- 外部DB/CRMのデータ品質担保・修正
- 高度な推薦/最適化モデルの新規開発（別PJ）

---

## Core Principles（設計原則：短く）
- **State中心**：LangGraph State を唯一の共有“真実”とし、ノードは差分更新（Δ）を返す（詳細は 04/06）
- **契約駆動**：Node Specs と R/W マトリクスを“実装とレビューの契約”とする（06）
- **安全側に倒す**：不確実なら断言せず、根拠提示・確認・エスカレーション
- **観測して改善**：メトリクス→回帰→LLMOpsで継続改善（11/12）

---

## Quick Links（次に読むべき）
- 仕様と境界：01_CONTEXT_AND_SCOPE.md / 02_REQUIREMENTS.md
- 概観：03_ARCHITECTURE_OVERVIEW.md
- 実装契約：04_STATE_MODEL.md / 05_WORKFLOW_DM.md / 06_NODE_SPECS.md
- 運用品質：13_SECURITY_AND_GUARDRAILS.md / 14_OBSERVABILITY.md / 15_TEST_PLAN.md

---

## Conventions（最低限の運用ルール）
- ファイル名は `NN_TITLE.md`（NNは2桁）で並び順を固定する
- Mermaid（bierner.markdown-mermaid）
  - subgraphタイトル/ノードラベルは `["..."]` で囲う（パース安定化）
  - ラベル中の改行は `<br/>` を使う
  - 条件ラベルも `"..."` で囲う（記号混在に強い）

---

## Change Log（このファイル）
- 本ファイル（00）は「ビジョン」と「品質目標」に限定し、詳細仕様は各章に委譲する
- 設計判断・仕様変更は `99_DECISIONS_LOG.md` を正とする



具体的に：アジャイルでのドキュメント構成例

スプリントで回しやすい形にすると、こんな感じが鉄板です。

00_VISION.md（目的・品質目標：薄くてOK）

01_CONTEXT_SCOPE.md（境界：薄くてOK、でも必須）

02_BACKLOG.md（Epic/Story/AC/優先度）

03_STATE_SPEC.md（常に更新）

04_NODE_CONTRACTS.md（常に更新）

05_RUNTIME_UC01.md（優先ユースケースだけ）

06_ADR/（決定ログ：増えるほど価値）

07_TEST_PLAN.md（goldenテスト一覧：常に更新）

08_OBSERVABILITY.md（最低限→徐々に厚く）

09_RUNBOOK.md（本番直前に厚く）
